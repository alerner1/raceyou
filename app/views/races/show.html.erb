<h1 class="text-center"><%= link_to Runner.all.find(@race.created_by.to_i).name, runner_path(Runner.all.find(@race.created_by.to_i)) %>'s Race</h1>
<div class="d-flex mt-5">
  <div class="d-flex flex-column pr-5 mr-5 mt-5">
    <h3 class="ml-5">Race details:</h3>
    <div class="d-flex flex-column mx-5">
      <div class="d-flex flex-row justify-content-between">
        <p class="font-weight-bold">Length</p>
        <p><%= "#{@race.length} #{@race.length_units}"%></p>
      </div>
      <div class="d-flex flex-row justify-content-between">
        <p class="font-weight-bold">Elevation Increase</p>
        <p><%= "#{@race.elevation_increase} #{@race.elevation_increase_units}" %> </p>
      </div>
      <div class="d-flex flex-row justify-content-between">
        <p class="font-weight-bold mr-5">Elevation Decrease</p>
        <p><%= "#{@race.elevation_decrease} #{@race.elevation_decrease_units}" %></p>
      </div>
      <div class="d-flex flex-row justify-content-between">
        <p class="font-weight-bold">Expires</p>
        <p><%= @race.expiration_date.strftime("%m/%d/%Y") %></p>
      </div>
    </div>
  </div>
  <div class="d-flex flex-column w-50">
    <div class="d-flex flex-row justify-content-between">
    <h3 class="ml-2">Runners</h3>
      <% if @race.closed == false %>
        <% if !@current_user.races.include?(@race) %>
          <%= button_to "Sign up for this race", registrations_path, method: :post, params: { :registration => {:race_id => @race.id, :runner_id => session[:runner_id] } }, class: "btn btn-outline-success my-2 my-sm-0"%>
         <% else %>
          <div class="d-flex">
            <% if @current_user.registrations.find_by(race_id: @race.id).completed == false %>
              <%= button_to "Enter Finish Time", edit_registration_path(@current_user.registrations.find_by(race_id: @race.id)), method: :get, class: "btn btn-outline-success my-2 my-sm-0 mr-2" %>
              <%= button_to "Back Out", registration_path(@current_user.registrations.find_by(race_id: @race.id)), method: :delete, data: {confirm: "Are you sure you want to back out of this race?"}, class: "btn btn-outline-success my-2 my-sm-0" %>
            <% else %>
              <p>Your time: <%= @current_user.registrations.find_by(race_id: @race.id).display_time %> </p>
            <% end %>
            <% if @current_user.id == @race.created_by.to_i %>
              <%= button_to "Close Race", race_path(@race), method: :patch, params: { :race => { :closed => true } }, class: "btn btn-outline-success my-2 my-sm-0 mx-2"%>         
              <%= button_to "Delete Race", race_path(@race), method: :delete, data: {confirm: "Are you sure you want to delete this race?"}, class: "btn btn-outline-success my-2 my-sm-0 mr-2" %>
            <% end %>
          </div>
        <% end %>
      <% else %>
        <div class="d-flex">
        <p class="mr-3">This race is now closed.</p>
        <% if @current_user.id == @race.created_by.to_i %>
          <%= button_to "Delete Race", race_path(@race), method: :delete, data: {confirm: "Are you sure you want to delete this race?"}, class: "btn btn-outline-success my-2 my-sm-0 mr-2" %>
        <% end %>
        </div>
      <% end %>
    </div>
    <% if @race.runners.length > 0 %>
      <table class="table">
        <thead>
          <tr>
            <th scope="col">Name</th>
            <th scope="col">Age</th>
            <th scope="col">Completed?</th>
            <th scope="col">Finish Time</th>
          </tr>
        </thead>
        <tbody>
          <% @race.runners.each do |runner| %>
            <tr>
              <td><%= link_to runner.name, runner_path(runner) %></td>
              <td><%= runner.age %></td>
              <td><%= runner.registrations.find_by(race_id: @race.id).is_completed? %></td>
              <% if runner.registrations.find_by(race_id: @race.id).completed == true %>
                <td><%= runner.registrations.find_by(race_id: @race.id).display_time %></td>
              <% else %>
                <td>N/A</td>
              <% end %>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% else %>
      <h5 class="mt-3 ml-2">None yet!</h5>
    <% end %>
  </div>
</div>